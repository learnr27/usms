<div style="top: 0;">
  <p-tabView>
    <p-tabPanel header="用户角度">
      <div class="ui-g">
        <div class="ui-g-3 left-panel">
          <p-panel header="组织机构树">
            <input pInputText type="text" placeholder="组织机构名称" size="14" [(ngModel)]="instQueryWord"/>
            <button pButton type="button" icon="fa-search" (click)="queryInstitution()"></button>
            <p-tree [value]="institutionTree" selectionMode="single"
                    [(selection)]="instSelectedNode"
                    (onNodeSelect)="nodeSelect($event)">
            </p-tree>
          </p-panel>
        </div>
        <div class="ui-g-9">
          <input type="text" pInputText placeholder="账号或姓名" [(ngModel)]="filter">
          <button pButton type="button" icon="fa-search" (click)="query()" label="查询"></button>
          <p-dataTable [value]="viewData" selectionMode="multiple" emptyMessage="{{emptyMessage}}">
            <p-column header="序号" [style]="{'width':'60px'}">
              <ng-template let-ri="rowIndex" pTemplate="body">
                <span>{{index[ri]}}</span>
              </ng-template>
            </p-column>
            <p-column selectionMode="multiple" [style]="{'width':'38px'} "></p-column>
            <p-column field="loginName" header="账号"></p-column>
            <p-column field="name" header="姓名"></p-column>
            <p-column field="gridNames" header="所在网格"></p-column>
            <p-column header="操作">
              <ng-template let-grid="rowData" pTemplate="body">
                <button type="button" pButton label="所在网格" icon="fa-edit" (click)="showDialog(grid.id)"></button>
              </ng-template>
            </p-column>
          </p-dataTable>
          <eve-paginator [rows]="page.size" [totalRecords]="page.totalElements"
                         [rowsPerPageOptions]="[10,20,30]" [pageLinkSize]="5" [first]="firstIndex"
                         (onSizeChange)="onSizeChange($event)" (onPageChange)="onPageChange($event)"></eve-paginator>
        </div>
      </div>
    </p-tabPanel>

    <p-tabPanel header="网格角度">
      <div class="ui-g">
        <input pInputText type="text" size="19" [(ngModel)]="tableQueryWord" placeholder="网格名称"/>
        <button pButton type="button" icon="fa-search" (click)="queryTreeTable()"></button>
        <p-treeTable selectionMode="single" [(selection)]="tableSelectedNode" [value]="tableTree">
          <p-column field="label" header="网格名称"></p-column>
          <p-column field="code" header="网格编码"></p-column>
          <p-column field="userNames" header="所属用户"></p-column>
          <p-column header="操作">
            <ng-template let-node="rowData" pTemplate="body">
              <button type="button" pButton label="所属用户" icon="fa-edit" (click)="showUserDialog(node)"></button>
            </ng-template>
          </p-column>
        </p-treeTable>
      </div>
    </p-tabPanel>
  </p-tabView>
</div>

<p-dialog header="所在网格" [width]="500" [(visible)]="display">
  <p-tree [value]="dialogTree" selectionMode="checkbox" [(selection)]="selectedNodes">
  </p-tree>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa-close" (click)="cancel()" label="取消"></button>
      <button type="button" pButton icon="fa-check" (click)="save()" label="确定"></button>
    </div>
  </p-footer>
</p-dialog>

<app-user-associate (onSaved)="onSaved($event)"></app-user-associate>
