<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm http://xmlns.jcp.org/xml/ns/persistence/orm_2_0.xsd"
                 version="2.1">

    <named-native-query name="Application.getAppByClientId"
                        result-class="net.evecom.common.usms.entity.ApplicationEntity">
        <query>select * from usms_applications where client_id = ?</query>
    </named-native-query>

    <named-native-query name="Application.getAppByClientSecret"
                        result-class="net.evecom.common.usms.entity.ApplicationEntity">
        <query>select * from usms_applications where client_secret = ?</query>
    </named-native-query>

    <named-native-query name="Application.listUsersByAppName"
                        result-class="net.evecom.common.usms.entity.UserEntity">
        <query>
            select * from usms_users u where u.id in
            (select ur.user_id from usms_user_role ur where ur.role_id in
            (select r.id from usms_roles r
            where r.id in (select pr.role_id from usms_privilege_role pr where pr.priv_id in
            (select p.id from usms_privileges p where p.id in
            (select po.oper_id from usms_privilege_operation po
            where po.oper_id in
            (select o.id from usms_operations o where o.application_id in
            (select a.id from usms_applications a where a.name = ?)
            and o.enabled = 1))
            and p.enabled = 1)) and r.enabled = 1)) and u.enabled = 1
        </query>
    </named-native-query>

</entity-mappings>